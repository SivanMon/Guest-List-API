<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guest List API</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg: #0b1020;
      --fg: #e7eaf3;
      --muted:#9aa4bf;
      --card:#141a2f;
      --accent:#7c9cff;
      --accent-2:#51d6a8;
      --danger:#ff6b6b;
      --ring: 0 0 0 2px rgba(124,156,255,.35), 0 8px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9fc; --fg:#0b1220; --muted:#51607a;
        --card:#ffffff; --accent:#335dff; --accent-2:#10b981; --danger:#ef4444;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg); background: radial-gradient(1200px 800px at 90% -10%, #1b2140 0%, transparent 60%),
                         radial-gradient(900px 700px at -10% 110%, #12334a 0%, transparent 60%),
                         var(--bg);
      display:flex; align-items:center; justify-content:center; padding:28px;
    }
    .wrap{width:min(1100px,100%); display:grid; gap:22px}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color:white; font-weight:900; letter-spacing:.5px; text-shadow:0 1px 0 rgba(0,0,0,.2);
      box-shadow:0 6px 20px rgba(0,0,0,.25);
    }
    .title{font-size:1.25rem; font-weight:800}
    .subtitle{color:var(--muted); font-size:.95rem}
    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:22px}
    @media (max-width:900px){ .grid{grid-template-columns: 1fr} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0)) border-box;
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding:22px;
      backdrop-filter: blur(8px);
      box-shadow: var(--ring);
    }
    .hero h1{margin:.2rem 0 0; font-size: clamp(1.4rem, 2.6vw, 2rem)}
    .hero p{margin:.35rem 0 0; color:var(--muted)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
    .btn{
      appearance:none; border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700;
      color:#fff; background:var(--accent); box-shadow:0 6px 18px rgba(51,93,255,.35);
      transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease;
    }
    .btn.secondary{background:var(--accent-2); box-shadow:0 6px 18px rgba(16,185,129,.32)}
    .btn.ghost{background:transparent; color:var(--fg); border:1px dashed rgba(255,255,255,.25)}
    .btn.danger{background:var(--danger)}
    .btn:active{transform: translateY(1px)}
    code, pre{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .kbd{display:inline-block; padding:.1rem .4rem; border-radius:8px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06)}
    .list{display:grid; gap:10px; margin-top:10px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 12px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08)}
    .row small{color:var(--muted)}
    .pill{font-size:.8rem; padding:.15rem .5rem; border-radius:999px; background:rgba(124,156,255,.15); color:var(--accent); border:1px solid rgba(124,156,255,.35)}
    .ok{color:var(--accent-2)}
    .err{color:var(--danger)}
    .mono{color:var(--muted)}
    .footer{color:var(--muted); font-size:.9rem; text-align:center; margin-top:6px}
    .input, select{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.06); color:var(--fg);
      outline:none;
    }
    label{font-weight:700; font-size:.9rem}
    .field{display:grid; gap:6px}
    .cols{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    @media (max-width:700px){ .cols{grid-template-columns:1fr} }
    .table{width:100%; border-collapse:collapse; margin-top:10px}
    .table th,.table td{padding:10px 12px; text-align:left; border-bottom:1px dashed rgba(255,255,255,.15)}
    .muted{color:var(--muted)}
    .spin{display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,.35); border-top-color:transparent; border-radius:50%; vertical-align:-2px; animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <div class="brand">
        <div class="logo">GL</div>
        <div>
          <div class="title">Guest List API</div>
          <div class="subtitle">A tiny server to demo guests stored in DynamoDB (or a local stub).</div>
        </div>
      </div>
      <div id="statusPill" class="pill">status: unknown</div>
    </header>

    <section class="grid">
      <!-- Left: Hero + Quick Actions -->
      <div class="card hero">
        <h1>Fast API checks, right from this page.</h1>
        <p>Use the buttons below to ping the health endpoint, list guests, or add a quick sample guest for testing.</p>
        <div class="btns">
          <button class="btn" id="btnHealth">Check Health</button>
          <button class="btn secondary" id="btnList">List Guests</button>
          <button class="btn ghost" id="btnAddSample">Add Sample Guest</button>
          <button class="btn danger" id="btnClear" title="Only if your API supports it">Clear (danger)</button>
        </div>

        <div class="list" style="margin-top:18px">
          <div class="row"><div><strong>Base URL</strong><div class="mono" id="baseUrl"></div></div><small class="pill">auto-detected</small></div>
          <div class="row"><div><strong>Health</strong><div class="mono">GET <span class="muted">/health</span></div></div><small>expects 200</small></div>
          <div class="row"><div><strong>List Guests</strong><div class="mono">GET <span class="muted">/guests</span></div></div><small>returns JSON array</small></div>
          <div class="row"><div><strong>Add Guest</strong><div class="mono">POST <span class="muted">/guests</span> <small class="muted">{"name": "...", "phone": "..."}</small></div></div><small>returns created</small></div>
        </div>
      </div>

      <!-- Right: Quick Create Form -->
      <div class="card">
        <h2 style="margin:0 0 10px">Quick Add Guest</h2>
        <div class="cols">
          <div class="field">
            <label for="name">Name</label>
            <input id="name" class="input" placeholder="e.g., Ada Lovelace" />
          </div>
          <div class="field">
            <label for="phone">Phone</label>
            <input id="phone" class="input" placeholder="+1 555 123 4567" />
          </div>
        </div>
        <div class="field" style="margin-top:10px">
          <label for="note">Note (optional)</label>
          <input id="note" class="input" placeholder="Table 4 / Vegetarian / VIP" />
        </div>
        <div class="btns" style="margin-top:14px">
          <button class="btn secondary" id="btnAdd">Add Guest</button>
          <button class="btn ghost" id="btnReset">Reset</button>
        </div>
        <p class="muted" style="margin-top:10px">
          Tip: You can also use <span class="kbd">curl</span>:
          <code>curl -X POST -H "Content-Type: application/json" -d '{"name":"Ada","phone":"+15551234"}' <span id="curlUrl"></span>/guests</code>
        </p>
      </div>
    </section>

    <!-- Data table -->
    <section class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap">
        <h2 style="margin:0">Guests</h2>
        <small class="muted">Live preview from your running server</small>
      </div>
      <table class="table" id="tbl">
        <thead><tr><th>Name</th><th>Phone</th><th>Note</th><th>ID</th></tr></thead>
        <tbody id="tbody"><tr><td colspan="4" class="muted">No data yet. Click <strong>List Guests</strong>.</td></tr></tbody>
      </table>
    </section>

    <p class="footer">Built with ♥ — supports light/dark mode, no external dependencies.</p>
  </main>

  <script>
    // --- Config & helpers ---
    const base = (location.origin); // works for container/LoadBalancer or localhost
    const $ = (id)=>document.getElementById(id);
    $("baseUrl").textContent = base;
    $("curlUrl").textContent = base;

    const setStatus = (text, ok) => {
      const el = $("statusPill");
      el.textContent = text;
      el.style.borderColor = ok ? "rgba(16,185,129,.4)" : "rgba(239,68,68,.45)";
      el.style.background = ok ? "rgba(16,185,129,.15)" : "rgba(239,68,68,.15)";
      el.style.color = ok ? "var(--accent-2)" : "var(--danger)";
    };

    const asJSON = async (res) => {
      const ct = res.headers.get("content-type") || "";
      if (ct.includes("application/json")) return res.json();
      return res.text();
    };

    const renderRows = (arr) => {
      const tbody = $("tbody");
      if (!Array.isArray(arr) || !arr.length){
        tbody.innerHTML = `<tr><td colspan="4" class="muted">No guests found.</td></tr>`;
        return;
      }
      tbody.innerHTML = arr.map(g => {
        const id = g.id || g.guestId || g.pk || "";
        const note = g.note || g.notes || "";
        const phone = g.phone || g.phoneNumber || "";
        const name = g.name || g.fullName || g.guestName || "—";
        return `<tr><td>${escapeHtml(name)}</td><td>${escapeHtml(phone)}</td><td>${escapeHtml(note)}</td><td class="muted">${escapeHtml(String(id))}</td></tr>`;
      }).join("");
    };

    const escapeHtml = (s) => String(s)
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#39;");

    const busy = (btn, on=true)=>{
      if(!btn) return;
      btn.disabled = on;
      btn.dataset.prev = btn.textContent;
      btn.textContent = on ? "Working…" : btn.dataset.prev || "Done";
    };

    // --- Actions ---
    $("btnHealth").onclick = async (e)=>{
      busy(e.target,true);
      setStatus("checking health…", true);
      try{
        const res = await fetch(base + "/health");
        const ok = res.ok;
        const body = await asJSON(res);
        setStatus(ok ? "healthy ✓" : "unhealthy ✕", ok);
        console.log("health:", body);
      }catch(err){
        console.error(err);
        setStatus("unreachable ✕", false);
      }finally{ busy(e.target,false); }
    };

    $("btnList").onclick = async (e)=>{
      busy(e.target,true);
      try{
        const res = await fetch(base + "/guests");
        const data = await asJSON(res);
        renderRows(data);
      }catch(err){
        console.error(err);
        renderRows([]);
      }finally{ busy(e.target,false); }
    };

    $("btnAddSample").onclick = async (e)=>{
      busy(e.target,true);
      try{
        const res = await fetch(base + "/guests", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ name:"Ada Lovelace", phone:"+1 555 123 4567", note:"VIP sample" })
        });
        if(res.ok){ $("btnList").click(); }
      }catch(err){ console.error(err); }
      finally{ busy(e.target,false); }
    };

    $("btnClear").onclick = async (e)=>{
      // Only works if your API provides DELETE /guests (optional)
      if(!confirm("Clear all guests? This cannot be undone.")) return;
      busy(e.target,true);
      try{
        const res = await fetch(base + "/guests", { method:"DELETE" });
        if(res.ok){ $("btnList").click(); }
      }catch(err){ console.error(err); }
      finally{ busy(e.target,false); }
    };

    $("btnAdd").onclick = async ()=>{
      const name = $("name").value.trim();
      const phone = $("phone").value.trim();
      const note = $("note").value.trim();
      if(!name){ alert("Please enter a name."); return; }
      try{
        const res = await fetch(base + "/guests", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ name, phone, note })
        });
        if(res.ok){
          $("name").value = ""; $("phone").value=""; $("note").value="";
          $("btnList").click();
        }else{
          const t = await res.text();
          alert("Create failed: " + t);
        }
      }catch(err){ alert("Request failed."); console.error(err); }
    };

    $("btnReset").onclick = ()=>{
      $("name").value = ""; $("phone").value=""; $("note").value="";
    };

    // Try health check on load (non-blocking)
    (async ()=>{ try{
      const res = await fetch(base + "/health", { method:"GET" });
      setStatus(res.ok ? "healthy ✓" : "unhealthy ✕", res.ok);
    }catch{ setStatus("unreachable ✕", false); }})();
  </script>
</body>
</html>
